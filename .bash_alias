# Add an alias.
addalias() {
	trap 'previous_command=$this_command; this_command=$BASH_COMMAND' DEBUG
	orig="$previous_command" # Original command.
	# Check if the -s option is enabled.
	while getopts "s" opt; do
		case ${opt} in
			s) local should_save="true"; shift;;
		esac
	done
	strip=${orig%-s} # Remove option if it's at the end. 
	echo $strip
	strip=${strip#[a-zA-Z0-9_]*\s*(-s)*} # Removes the initial function call, be it addalias, or alias, w/e. Also removes a -s if it is there.
	echo $strip
	full="alias$strip"
	# FUTURE REFERENCE: prawns=$(expr "abcdef" : "abc")
	if [ -n should_save ]; then
		# Make sure the file exists before you continue.
		if [ ! -f $ABSPATH/.usr_aliases ]; then
			echo "File .usr_aliases does not exist. Creating."
			touch $ABSPATH/.usr_aliases
		fi
		# pre ultimately contains "alias myname=" to figure out if the name has already been aliased.
		pre=`expr match "$strip" '\(.*=\)'`
		pre="alias$pre"
		current=$(alias)  # Contains all aliases currently defined
		# Compare lengths of strings to determine if current contains pre.
		first=$(echo -n $current | wc -m)
		second=$(echo -n ${current#*$pre} | wc -m)
		# echo $(expr "$current" : "$pre")
		if [ "$first" -ne "$second" ]; then
			echo "SOMEBODY IS TRYING TO REALIAS"
			# What are we going to do if they try to realias? 
			# Unalias for the current session? Unalias semi-permanently in my file?
		else
			# It's a new alias, that's cool
			echo "Creating new permanent alias: $full"
			echo "$full" >> $ABSPATH/.usr_aliases
			src
		fi
	else
		eval full
	fi
}

# Include all user-created aliases if the generated file exists. 
if [ -f $ABSPATH/.usr_aliases ]; then
	. $ABSPATH/.usr_aliases
fi
